<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mixpanel Debug Test</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
        }
        .status {
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            font-size: 14px;
        }
        .success { background: #d1fae5; color: #065f46; }
        .error { background: #fee2e2; color: #991b1b; }
        .warning { background: #fef3c7; color: #92400e; }
        button {
            padding: 12px 24px;
            background: #6366f1;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            margin: 5px;
        }
        pre {
            background: #1f2937;
            color: #f9fafb;
            padding: 15px;
            border-radius: 8px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1>üêõ Mixpanel Debug Test</h1>
    
    <div id="status"></div>
    
    <button onclick="checkMixpanel()">1. Check Mixpanel Status</button>
    <button onclick="testEvent()">2. Send Test Event</button>
    <button onclick="checkNetwork()">3. Check Network Requests</button>
    
    <h3>Console Output:</h3>
    <pre id="console"></pre>
    
    <h3>Instructions:</h3>
    <ol>
        <li>Open browser DevTools (F12)</li>
        <li>Go to <strong>Network</strong> tab</li>
        <li>Click "Send Test Event"</li>
        <li>Look for requests to <code>api.mixpanel.com</code></li>
        <li>If you see them blocked, disable ad blocker for localhost</li>
    </ol>

    <!-- Mixpanel Script -->
    <script type="text/javascript">
        (function(f,b){if(!b.__SV){var e,g,i,h;window.mixpanel=b;b._i=[];b.init=function(e,f,c){function g(a,d){var b=d.split(".");2==b.length&&(a=a[b[0]],d=b[1]);a[d]=function(){a.push([d].concat(Array.prototype.slice.call(arguments,0)))}}var a=b;"undefined"!==typeof c?a=b[c]=[]:c="mixpanel";a.people=a.people||[];a.toString=function(a){var d="mixpanel";"mixpanel"!==c&&(d+="."+c);a||(d+=" (stub)");return d};a.people.toString=function(){return a.toString(1)+".people (stub)"};i="disable time_event track track_pageview track_links track_forms track_with_groups add_group set_group remove_group register register_once alias unregister identify name_tag set_config reset opt_in_tracking opt_out_tracking has_opted_in_tracking has_opted_out_tracking clear_opt_in_out_tracking start_batch_senders people.set people.set_once people.unset people.increment people.append people.union people.track_charge people.clear_charges people.delete_user people.remove".split(" ");for(h=0;h<i.length;h++)g(a,i[h]);var j="set set_once union unset remove delete".split(" ");a.get_group=function(){function b(c){d[c]=function(){call2_args=arguments;call2=[c].concat(Array.prototype.slice.call(call2_args,0));a.push([e,call2])}}for(var d={},e=["get_group"].concat(Array.prototype.slice.call(arguments,0)),c=0;c<j.length;c++)b(j[c]);return d};b._i.push([e,f,c])};b.__SV=1.2;e=f.createElement("script");e.type="text/javascript";e.async=!0;e.src="undefined"!==typeof MIXPANEL_CUSTOM_LIB_URL?MIXPANEL_CUSTOM_LIB_URL:"file:"===f.location.protocol&&"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js".match(/^\/\//)?"https://cdn.mxpnl.com/libs/mixpanel-2-latest.min.js":"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js";g=f.getElementsByTagName("script")[0];g.parentNode.insertBefore(e,g)}})(document,window.mixpanel||[]);
    </script>

    <script>
        const TOKEN = '40d54d40a7574faf1824539bbe5462df';
        let logText = '';
        
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            logText = `[${timestamp}] ${message}\n` + logText;
            document.getElementById('console').textContent = logText;
            console.log(message);
        }
        
        function showStatus(message, type) {
            const statusDiv = document.getElementById('status');
            statusDiv.className = `status ${type}`;
            statusDiv.innerHTML = message;
        }
        
        function checkMixpanel() {
            log('üîç Checking Mixpanel status...');
            
            // Check if mixpanel object exists
            if (typeof mixpanel === 'undefined') {
                showStatus('‚ùå Mixpanel object not found', 'error');
                log('‚ùå mixpanel is undefined');
                return;
            }
            
            log('‚úÖ mixpanel object exists');
            
            // Check if it's the stub or real library
            const isStub = mixpanel.toString().includes('stub');
            log(`Mixpanel type: ${isStub ? 'STUB (not fully loaded)' : 'FULL LIBRARY (loaded)'}`);
            
            // Check if init function exists
            if (typeof mixpanel.init === 'function') {
                log('‚úÖ mixpanel.init exists');
                
                // Try to initialize
                try {
                    mixpanel.init(TOKEN, { 
                        debug: true, 
                        track_pageview: false,
                        ignore_dnt: true // Ignore "Do Not Track" for testing
                    });
                    log('‚úÖ Mixpanel initialized with token');
                    log(`Token: ${TOKEN.substring(0, 10)}...`);
                    log('‚ö†Ô∏è "Do Not Track" will be ignored for testing');
                    
                    showStatus(
                        `<strong>${isStub ? '‚ö†Ô∏è Mixpanel STUB Mode' : '‚úÖ Mixpanel Loaded'}</strong><br><br>` +
                        `${isStub ? 
                            'The Mixpanel library script is blocked (likely by ad blocker).<br>' +
                            'Events will queue but won\'t be sent to Mixpanel.<br><br>' +
                            '<strong>Fix:</strong> Disable ad blocker for localhost or add mixpanel.com to whitelist.' : 
                            'Mixpanel is fully loaded and ready to track events!'}`,
                        isStub ? 'warning' : 'success'
                    );
                } catch (error) {
                    log('‚ùå Error initializing: ' + error.message);
                    showStatus('‚ùå Error initializing Mixpanel: ' + error.message, 'error');
                }
            } else {
                log('‚ùå mixpanel.init not found');
                showStatus('‚ùå Mixpanel init function not found', 'error');
            }
        }
        
        function testEvent() {
            log('üìä Sending test event...');
            
            if (typeof mixpanel === 'undefined') {
                showStatus('‚ùå Mixpanel not available. Click "Check Status" first.', 'error');
                return;
            }
            
            try {
                // Send a test event
                mixpanel.track('Test Event from Debug Page', {
                    test_property: 'hello',
                    timestamp: new Date().toISOString(),
                    source: 'debug_page'
                });
                
                log('‚úÖ Event tracked: "Test Event from Debug Page"');
                log('‚è≥ Check Network tab for requests to api.mixpanel.com');
                log('‚è≥ Check Mixpanel Live View in ~5 seconds');
                
                showStatus(
                    '<strong>‚úÖ Event Sent!</strong><br><br>' +
                    '1. Open DevTools Network tab<br>' +
                    '2. Look for requests to <code>api.mixpanel.com</code><br>' +
                    '3. If blocked, disable ad blocker<br>' +
                    '4. Check Mixpanel Live View',
                    'success'
                );
            } catch (error) {
                log('‚ùå Error tracking event: ' + error.message);
                showStatus('‚ùå Error: ' + error.message, 'error');
            }
        }
        
        function checkNetwork() {
            showStatus(
                '<strong>üì° How to Check Network Requests:</strong><br><br>' +
                '1. Open DevTools (F12)<br>' +
                '2. Click <strong>Network</strong> tab<br>' +
                '3. Filter by "mixpanel" or "api.mixpanel.com"<br>' +
                '4. Click "Send Test Event" button<br>' +
                '5. You should see POST requests to api.mixpanel.com<br><br>' +
                '<strong>If you see:</strong><br>' +
                '‚Ä¢ ‚úÖ Status 200 = Working!<br>' +
                '‚Ä¢ ‚ùå Blocked/Failed = Ad blocker is blocking it<br>' +
                '‚Ä¢ üîç No requests = Script didn\'t load',
                'warning'
            );
            log('üì° See instructions above for checking network requests');
        }
        
        // Auto-check on load
        window.addEventListener('load', () => {
            setTimeout(() => {
                log('üöÄ Page loaded. Click "Check Mixpanel Status" to begin.');
                checkMixpanel();
            }, 1000);
        });
    </script>
</body>
</html>

